<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IRC Chat</title>
    <script src = "socket.io/socket.io.js"></script>
    <link rel="stylesheet" type="text/css" href="CSS/Chat%20Bubble.css">
    <link rel="stylesheet" type="text/css" href="CSS/Window.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="Backend.js"></script>
    <script src="Frontend.js"></script>
</head>
<body>


    <div id="Messages">
    </div>

    <!--Ugly backend stuff-->
    <script>
        //Connect to chat server
        //Todo: Make the ip the client connects to be able to be set to anything
        const server = io.connect("http://24.185.152.102:25565", {reconnection: true});
        let _pageHeight = 0;


        server.on("connect", function()
        {
            server.on("UpdateMessages", function(data)
            {
                DeleteAllChatBubbles();
                //ITERATE data.Messages WITH message:
                data.Messages.forEach(function(message){
                    if(message.Id == data.SelfID)
                    {
                        AddChatBubble(true, message.Text);
                    }
                    else{
                        AddChatBubble(false, message.Text, message.Id);
                    }

                });//ForEach in data (Print chat bubbles)


                //IF(current scrollY >= _pageHeight): Scroll to bottom of page
                if(window.scrollY + window.innerHeight == _pageHeight)
                {
                    window.scrollTo(0, document.documentElement.scrollHeight);
                }
                //_pageHeight = current page height
                _pageHeight = document.documentElement.scrollHeight;

            });//OnUpdateMessages()
        });//OnConnect()
    </script>

    <!--Beautiful frontend stuff-->
    <script>
        //TODO: replace this with text box and send button
        document.addEventListener("keypress", function(key)
        {
           if(key.key == "m")
           {
               let text = prompt("Enter message here", "blahblah");
               TextServer(server, text);
           }
        });

    </script>
</body>
</html>